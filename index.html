<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MAâ†’GCC | Jihan Lahmar</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: #000;
      color: #fff;
      font-family: 'SF Mono', 'Consolas', monospace;
      margin: 0;
      padding: 2rem 1.5rem;
      line-height: 1.5;
    }
    .container { max-width: 900px; margin: 0 auto; }
    header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 2.5rem;
      border-bottom: 1px solid #333;
      padding-bottom: 1rem;
    }
    h1 {
      font-weight: 400;
      font-size: 1.3rem;
      letter-spacing: -0.5px;
    }
    .social {
      font-size: 0.85rem;
      color: #666;
    }
    .social a { color: #666; text-decoration: none; margin-left: 8px; }
    .social a:hover { color: #fff; }

    .chart-container {
      height: 180px;
      margin: 1.5rem 0 2rem;
      position: relative;
    }

    .metrics {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    .metric-card {
      background: #0a0a0a;
      padding: 1rem;
      border: 1px solid #222;
      border-radius: 4px;
    }
    .metric-label { font-size: 0.8rem; color: #666; margin-bottom: 4px; }
    .metric-value { font-size: 1.1rem; font-weight: 500; }
    .up { color: #4ade80; }
    .down { color: #f87171; }

    footer {
      margin-top: 3rem;
      color: #444;
      font-size: 0.8rem;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ‡²ğŸ‡¦â†’ğŸ‡¸ğŸ‡¦ğŸ‡¦ğŸ‡ªğŸ‡¶ğŸ‡¦ CAPITAL FLOW MONITOR</h1>
      <div class="social">
        <a href="https://linkedin.com/in/jihanlahmar" target="_blank">in/jihanlahmar</a>
        <a href="https://twitter.com/jihanlahmar" target="_blank">@jihanlahmar</a>
      </div>
    </header>

    <p id="last-update" style="color:#666; font-size:0.9rem;">Loading...</p>

    <div class="chart-container">
      <canvas id="priceChart"></canvas>
    </div>

    <div class="metrics" id="metrics"></div>

    <footer>
      Built in Rabat â€¢ Public alpha â€¢ Updated 2x/week
    </footer>
  </div>

  <script>
    // ğŸ” REPLACE THIS URL WITH YOUR ACTUAL JSON GIST RAW LINK
    const GIST_URL = "https://gist.githubusercontent.com/jihanlahmar/6aa87a38d4c717cf98b7672ce6ff89fc/raw/eff6c8f3083784f0c28728ac240d216dc456de2b/gistfile1.txt";

    let chartInstance = null;

    fetch(GIST_URL)
      .then(res => {
        if (!res.ok) throw new Error('Gist not found');
        return res.json();
      })
      .then(data => {
        document.getElementById('last-update').textContent = `Last update: ${data.date}`;

        const assets = ['MAD_USD', 'SAR_USD', 'AED_USD', 'TASI_Saudi', 'ADX_UAE', 'Fertilizer_ETF_SOIL'];
        const metricsDiv = document.getElementById('metrics');

        assets.forEach(key => {
          const val = data.data[key];
          if (!val || val.error) return;

          const change = val.change_1d_pct;
          const cls = change >= 0 ? 'up' : 'down';
          const sign = change >= 0 ? '+' : '';

          metricsDiv.innerHTML += `
            <div class="metric-card">
              <div class="metric-label">${key.replace(/_/g, ' ')}</div>
              <div class="metric-value">${val.price} <span class="${cls}">${sign}${change}%</span></div>
            </div>
          `;
        });

        // Simple chart: MAD vs SAR (using current + fake 4-day history for visual)
        const ctx = document.getElementById('priceChart').getContext('2d');
        const days = ['5d', '4d', '3d', '2d', '1d', 'Today'];
        const madBase = data.data.MAD_USD?.price || 0.1082;
        const madFake = [
          madBase + 0.0004,
          madBase + 0.0003,
          madBase + 0.0002,
          madBase + 0.0001,
          madBase,
          madBase
        ];
        const sarVal = data.data.SAR_USD?.price || 0.2667;
        const sarFake = Array(6).fill(sarVal);

        if (chartInstance) chartInstance.destroy();
        chartInstance = new Chart(ctx, {
          type: 'line',
           {
            labels: days,
            datasets: [{
              label: 'MAD/USD',
               madFake,
              borderColor: '#4ade80',
              borderWidth: 2,
              fill: false,
              tension: 0.3
            }, {
              label: 'SAR/USD',
               sarFake,
              borderColor: '#60a5fa',
              borderWidth: 1,
              borderDash: [4, 2],
              fill: false,
              tension: 0.3
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                labels: { color: '#666', font: { size: 10 } }
              }
            },
            scales: {
              x: { ticks: { color: '#444' }, grid: { color: '#111' } },
              y: { ticks: { color: '#444' }, grid: { color: '#111' } }
            }
          }
        });
      })
      .catch(err => {
        document.getElementById('last-update').innerHTML = '<span style="color:#f87171">âš ï¸ Data feed offline</span>';
      });
  </script>
</body>
</html>
